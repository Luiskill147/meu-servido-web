import random
import time

class JogoPPTLS:
    def __init__(self):
        self.opcoes = ['pedra', 'papel', 'tesoura', 'spock', 'lagarto']
        self.regras = {
            'pedra': ['tesoura', 'lagarto'],
            'papel': ['pedra', 'spock'],
            'tesoura': ['papel', 'lagarto'],
            'spock': ['pedra', 'tesoura'],
            'lagarto': ['papel', 'spock']
        }
        self.historico_jogador = []
        self.historico_ia = []
        self.pontuacao_jogador = 0
        self.pontuacao_ia = 0

    def escolher_ia(self):
        if not self.historico_jogador:
            return random.choice(self.opcoes)
        padrao = self.detectar_padrao()
        if padrao:
            return self.prever_jogada(padrao)
        return random.choice(self.opcoes)

    def detectar_padrao(self):
        if len(self.historico_jogador) < 3:
            return None
        for i in range(len(self.historico_jogador) - 2):
            padrao = self.historico_jogador[i:i + 2]
            if padrao == self.historico_jogador[-2:]:
                return padrao
        return None

    def prever_jogada(self, padrao):
        ultima_jogada = padrao[1]
        vulnerabilidades = []
        for jogada, derrotas in self.regras.items():
            if ultima_jogada in derrotas:
                vulnerabilidades.append(jogada)
        return random.choice(vulnerabilidades)

    def determinar_vencedor(self, jogador, ia):
        if jogador == ia:
            return 'empate'
        if ia in self.regras[jogador]:
            return 'jogador'
        return 'ia'

    def jogar(self):
        jogador = input("Escolha pedra, papel, tesoura, spock ou lagarto: ").lower()
        if jogador not in self.opcoes:
            print("Opção inválida.")
            return
        ia = self.escolher_ia()
        vencedor = self.determinar_vencedor(jogador, ia)

        print(f"Jogador: {jogador}, IA: {ia}")
        if vencedor == 'jogador':
            print("Você venceu!")
            self.pontuacao_jogador += 1
        elif vencedor == 'ia':
            print("A IA venceu!")
            self.pontuacao_ia += 1
        else:
            print("Empate!")

        self.historico_jogador.append(jogador)
        self.historico_ia.append(ia)
        print(f"Pontuação: Jogador {self.pontuacao_jogador}, IA {self.pontuacao_ia}")

jogo = JogoPPTLS()
while True:
    jogo.jogar()
    if input("Jogar novamente? (s/n): ").lower() != 's':
        break
